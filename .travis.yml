language: android
sudo: required
jdk: oraclejdk8

notifications:  #Optional
  email:
      - samith143@gmail.com

before_cache:
    - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
    - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories: #Cache all dirs under .gradle folder
    - $HOME/.gradle/daemon      #Cache daemon logs
    - $HOME/.gradle/wrapper/   #Cache the gradle
    - $HOME/.gradle/native     #Cache library downloaded from the gradle dependency
    - $HOME/.gradle/caches/
    - $HOME/.android/build-cache

env:
 matrix:
    - ANDROID_TARGET=android-24 ANDROID_ABI=armeabi-v7a
    - ANDROID_TARGET=android-21 ANDROID_ABI=armeabi-v7a
 global:
    - ANDROID_API=25
    - EMULATOR_API=21
    - ANDROID_BUILD_TOOLS=26.0.0
    - ADB_INSTALL_TIMEOUT=10    #Time out to 10 mins/2 minutes by default

android:
    update_sdk: true  #Check for the updates each time you run the build.
    components:
        - platform-tools
        - tools
        - build-tools-$ANDROID_BUILD_TOOLS    #Build tool version
        - android-$ANDROID_API  #targate api version

        # Additional components
        - extra-google-google_play_services
        - extra-google-m2repository  # support library
        - extra-android-m2repository # for design library

        #system images for emulator
        #- sys-img-armeabi-v7a-android-$ANDROID_API_LEVEL
        #- sys-img-armeabi-v7a-android-$EMULATOR_API_LEVEL
        - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
        - sys-img-armeabi-v7a-addon-google_apis-google-$EMULATOR_API_LEVEL

 licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+



before_script:
  - chmod +x gradlew #Grant permissions
  - android list targets
  - echo no | android create avd --force -n test -t $ANDROID_TARGET --abi $ANDROID_ABI  #Create AVD for given api
  - emulator -avd test -no-skin -no-audio -no-window & #Start emulator


script:
  - echo "Travis branch is $TRAVIS_BRANCH"    #Print out which branch it is.
  - echo "Travis branch is in pull request $TRAVIS_PULL+REQUEST"    #Print out pull request number.
  - android-wait-for-emulator             #Run wait for the emulator script.
  - adb devices                           #Display list of devices
  - adb shell input keyevent 82 &
  #connectedCheck executes instrumentation tests located in src/androidTests/
  #- ./gradlew connectedAndroidTest -PdisablePreDex --stacktrace
  - ./gradlew connectedAndroidTest -PdisablePreDex --stacktrace

before_install:
  - chmod +x gradlew
  - pip install --user codecov    #Install codecov
  - ./gradlew dependencies || true

after_success:
  - codecov                       #Run codecov

after_failure: "cat $TRAVIS_BUILD_DIR/app/build/outputs/lint-results-debug.xml"